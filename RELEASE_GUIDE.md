# ç»Ÿä¸€CICDå‘å¸ƒæŒ‡å—

## ğŸš€ æ–°çš„ç»Ÿä¸€CICDæµç¨‹

### å·¥ä½œæµåˆå¹¶è¯´æ˜
å·²å°†åŸæ¥çš„ä¸‰ä¸ªworkflowï¼ˆCI/CDã€Deployã€Release Managementï¼‰åˆå¹¶ä¸ºä¸€ä¸ªç»Ÿä¸€çš„ **CICD Pipeline**ï¼Œå…·å¤‡ä»¥ä¸‹åŠŸèƒ½ï¼š

- âœ… **æŒç»­é›†æˆ**: æµ‹è¯•ã€æ„å»ºã€ä»£ç è´¨é‡æ£€æŸ¥
- âœ… **æŒç»­éƒ¨ç½²**: è‡ªåŠ¨éƒ¨ç½²åˆ°staging/productionç¯å¢ƒ  
- âœ… **å‘å¸ƒç®¡ç†**: è‡ªåŠ¨å’Œæ‰‹åŠ¨å‘å¸ƒæ§åˆ¶
- âœ… **å®¹å™¨åŒ–**: Dockeré•œåƒæ„å»ºå’Œæ¨é€
- âœ… **å®‰å…¨æ‰«æ**: ä»£ç å’Œå®¹å™¨å®‰å…¨æ£€æŸ¥

## ğŸ¤– æ™ºèƒ½å‘å¸ƒç³»ç»Ÿ (æ–°å¢åŠŸèƒ½)

### åŸºäºCommitæ¶ˆæ¯è‡ªåŠ¨æ£€æµ‹å‘å¸ƒç±»å‹
ç°åœ¨å¯ä»¥é€šè¿‡commitæ¶ˆæ¯çš„å…³é”®è¯è‡ªåŠ¨å†³å®šå‘å¸ƒç±»å‹ï¼Œæ— éœ€æ‰‹åŠ¨é€‰æ‹©ï¼

#### ğŸš€ æ™ºèƒ½æ£€æµ‹è§„åˆ™
| Commitæ¨¡å¼ | å‘å¸ƒç±»å‹ | ç‰ˆæœ¬å˜åŒ– | ç¤ºä¾‹ |
|-----------|---------|---------|------|
| `feat!:`, `BREAKING CHANGE` | **major** | 0.1.0 â†’ 1.0.0 | `feat!: é‡æ„API` |
| `feat:`, `feature:`, `minor:` | **minor** | 0.1.0 â†’ 0.2.0 | `feat: æ–°å¢åŠŸèƒ½` |
| `fix:`, `bugfix:`, `patch:` | **patch** | 0.1.0 â†’ 0.1.1 | `fix: ä¿®å¤bug` |
| `alpha:`, `experimental:` | **alpha** | 0.1.0 â†’ 0.1.1-alpha.0 | `alpha: å®éªŒåŠŸèƒ½` |
| `beta:`, `docs:`, `refactor:` | **beta** | 0.1.0 â†’ 0.1.1-beta.0 | `docs: æ›´æ–°æ–‡æ¡£` |
| `wip:`, `[skip release]` | **è·³è¿‡** | æ— å˜åŒ– | `wip: å¼€å‘ä¸­` |

#### âœ¨ æ™ºèƒ½å‘å¸ƒä½¿ç”¨æ–¹æ³•
```bash
# 1. ä½¿ç”¨æ™ºèƒ½commitæ¶ˆæ¯
git commit -m "feat: æ·»åŠ ç”¨æˆ·è®¤è¯åŠŸèƒ½"    # è‡ªåŠ¨åˆ›å»ºminorç‰ˆæœ¬
git commit -m "fix: è§£å†³ç™»å½•bug"        # è‡ªåŠ¨åˆ›å»ºpatchç‰ˆæœ¬  
git commit -m "feat!: é‡æ„APIæ¥å£"       # è‡ªåŠ¨åˆ›å»ºmajorç‰ˆæœ¬
git commit -m "docs: æ›´æ–°æ–‡æ¡£ [skip release]"  # è·³è¿‡å‘å¸ƒ

# 2. æ¨é€åˆ°mainåˆ†æ”¯
git push origin main

# 3. ç³»ç»Ÿè‡ªåŠ¨åˆ†æcommitå¹¶åˆ›å»ºå¯¹åº”ç‰ˆæœ¬ï¼
```

è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ï¼š[docs/SMART_RELEASE.md](docs/SMART_RELEASE.md)

## ğŸ›ï¸ æ‰‹åŠ¨å‘å¸ƒæ–¹æ³• (å¤‡ç”¨é€‰é¡¹)

### æ–¹æ³•1: GitHubç½‘é¡µç•Œé¢ (æ¨è)
1. è®¿é—®: https://github.com/Last-emo-boy/infra-core/actions
2. é€‰æ‹© **"CICD Pipeline"** å·¥ä½œæµ
3. ç‚¹å‡» **"Run workflow"** æŒ‰é’®
4. é…ç½®å‚æ•°ï¼š
   - **release_type**: é€‰æ‹©å‘å¸ƒç±»å‹ (patch/minor/major/beta/alpha)
   - **deploy_environment**: é€‰æ‹©éƒ¨ç½²ç¯å¢ƒ (auto/staging/production/none)
5. ç‚¹å‡» **"Run workflow"** æ‰§è¡Œ

### æ–¹æ³•2: ä½¿ç”¨PowerShellè„šæœ¬ (å·²æ›´æ–°)
```powershell
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
./scripts/release.ps1 -ReleaseType patch    # Bugä¿®å¤: 0.1.0 â†’ 0.1.1
./scripts/release.ps1 -ReleaseType minor    # æ–°åŠŸèƒ½: 0.1.0 â†’ 0.2.0  
./scripts/release.ps1 -ReleaseType major    # é‡å¤§ç‰ˆæœ¬: 0.x.x â†’ 1.0.0
./scripts/release.ps1 -ReleaseType beta     # Betaæµ‹è¯•: 0.1.0 â†’ 0.1.1-beta.0
./scripts/release.ps1 -ReleaseType alpha    # Alphaæµ‹è¯•: 0.1.0 â†’ 0.1.1-alpha.0
```

### æ–¹æ³•3: ç›´æ¥ä½¿ç”¨GitHub CLI (å·²æ›´æ–°)
```powershell
# å‘å¸ƒæ–°ç‰ˆæœ¬
gh workflow run "CICD Pipeline" --ref main --field release_type=patch --field deploy_environment=auto

# ä»…éƒ¨ç½²ä¸å‘å¸ƒ
gh workflow run "CICD Pipeline" --ref main --field release_type=none --field deploy_environment=production
```

## ğŸ“Š ç‰ˆæœ¬å·ç´¯è®¡è§„åˆ™ (å·²é‡ç½®)

### å½“å‰çŠ¶æ€: 0.1.0 âœ…

#### Patchå‘å¸ƒ (ä¿®å¤bug)
```
0.1.0 â†’ 0.1.1 â†’ 0.1.2 â†’ 0.1.3 ...
```

#### Minorå‘å¸ƒ (æ–°åŠŸèƒ½)  
```
0.1.3 â†’ 0.2.0 â†’ 0.3.0 â†’ 0.4.0 ...
```

#### Majorå‘å¸ƒ (ç”Ÿäº§å°±ç»ª)
```
0.x.x â†’ 1.0.0 â†’ 2.0.0 â†’ 3.0.0 ...
```

#### é¢„å‘å¸ƒç‰ˆæœ¬
```
# Alphaç‰ˆæœ¬
0.1.0 â†’ 0.1.1-alpha.0 â†’ 0.1.1-alpha.1

# Betaç‰ˆæœ¬  
0.1.1-alpha.1 â†’ 0.1.1-beta.0 â†’ 0.1.1-beta.1

# è‡ªåŠ¨Beta (æ¨é€mainåˆ†æ”¯)
æ¯æ¬¡æ¨é€ â†’ 0.x.y-beta.z (è‡ªåŠ¨é€’å¢)
```

## ğŸ”„ æ–°çš„å‘å¸ƒæµç¨‹è¯´æ˜

### æ™ºèƒ½å‘å¸ƒ (æ¨è)
1. **ç¼–å†™æœ‰æ„ä¹‰çš„commitæ¶ˆæ¯** â†’ ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬ç±»å‹
2. **æ¨é€åˆ°mainåˆ†æ”¯** â†’ è‡ªåŠ¨æµ‹è¯•ã€æ„å»ºã€å‘å¸ƒã€éƒ¨ç½²
3. **æ— éœ€æ‰‹åŠ¨æ“ä½œ** â†’ å®Œå…¨è‡ªåŠ¨åŒ–æµç¨‹

### æ‰‹åŠ¨å‘å¸ƒ (å¤‡ç”¨)
- **GitHubç½‘é¡µç•Œé¢**: Actions â†’ CICD Pipeline â†’ Run workflow
- **PowerShellè„šæœ¬**: `./scripts/release.ps1 -ReleaseType patch`
- **GitHub CLI**: `gh workflow run "CICD Pipeline"`

### è‡ªåŠ¨è§¦å‘æ¡ä»¶
| è§¦å‘æ¡ä»¶ | æ‰§è¡Œæ“ä½œ |
|---------|---------|
| æ¨é€åˆ° `main` + æ™ºèƒ½commit | æµ‹è¯• â†’ æ„å»º â†’ **æ™ºèƒ½å‘å¸ƒ** â†’ éƒ¨ç½²production |
| æ¨é€åˆ° `develop` åˆ†æ”¯ | æµ‹è¯• â†’ æ„å»º â†’ éƒ¨ç½²staging |
| åˆ›å»ºPull Request | ä»…æµ‹è¯•å’Œä»£ç è´¨é‡æ£€æŸ¥ |
| æ‰‹åŠ¨è§¦å‘ | æ ¹æ®å‚æ•°æ‰§è¡Œç›¸åº”æ“ä½œ |

### éƒ¨ç½²ç­–ç•¥
- **developåˆ†æ”¯** â†’ è‡ªåŠ¨éƒ¨ç½²åˆ° **staging**
- **mainåˆ†æ”¯** â†’ è‡ªåŠ¨éƒ¨ç½²åˆ° **production** 
- **æ‰‹åŠ¨è§¦å‘** â†’ å¯é€‰æ‹©ä»»æ„ç¯å¢ƒ

## ğŸ¯ å®é™…ä½¿ç”¨æµç¨‹

### æ—¥å¸¸å¼€å‘
1. **å¼€å‘åŠŸèƒ½** â†’ æ¨é€åˆ°develop â†’ è‡ªåŠ¨éƒ¨ç½²stagingæµ‹è¯•
2. **åˆå¹¶åˆ°main** â†’ è‡ªåŠ¨ç”Ÿæˆbetaé¢„å‘å¸ƒ + éƒ¨ç½²production
3. **å‡†å¤‡å‘å¸ƒ** â†’ æ‰‹åŠ¨è§¦å‘å¯¹åº”ç±»å‹çš„æ­£å¼å‘å¸ƒ

### å‘å¸ƒå†³ç­–
- **ä¿®å¤bug**: é€‰æ‹© `patch`
- **æ–°åŠŸèƒ½**: é€‰æ‹© `minor` 
- **é‡å¤§æ›´æ–°**: é€‰æ‹© `major`
- **æµ‹è¯•ç‰ˆæœ¬**: é€‰æ‹© `alpha` æˆ– `beta`

## ğŸ“ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```powershell
# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬å’Œæ ‡ç­¾çŠ¶æ€
Get-Content VERSION
git tag -l | Sort-Object

# æŸ¥çœ‹workflowçŠ¶æ€
gh run list --workflow="CICD Pipeline"

# è§¦å‘ä¸åŒç±»å‹çš„å‘å¸ƒ
./scripts/release.ps1 -ReleaseType patch      # 0.1.0 â†’ 0.1.1
./scripts/release.ps1 -ReleaseType minor      # 0.1.0 â†’ 0.2.0
./scripts/release.ps1 -ReleaseType major      # 0.1.0 â†’ 1.0.0
./scripts/release.ps1 -ReleaseType beta       # 0.1.0 â†’ 0.1.1-beta.0

# æŸ¥çœ‹å‘å¸ƒå†å²
gh release list --limit 10
```

## âš¡ ä¸»è¦æ”¹è¿›

### å·¥ä½œæµç»Ÿä¸€
- âœ… **ä¸€ä¸ªworkflowæå®šæ‰€æœ‰**: æµ‹è¯•ã€æ„å»ºã€å‘å¸ƒã€éƒ¨ç½²
- âœ… **æ™ºèƒ½è§¦å‘**: æ ¹æ®åˆ†æ”¯å’Œäº‹ä»¶è‡ªåŠ¨é€‰æ‹©æ“ä½œ
- âœ… **çµæ´»é…ç½®**: æ‰‹åŠ¨è§¦å‘æ—¶å¯ç²¾ç¡®æ§åˆ¶

### ç‰ˆæœ¬æ§åˆ¶é‡ç½®
- âœ… **ç‰ˆæœ¬å·å·²é‡ç½®**: ä»0.1.0å¼€å§‹
- âœ… **æ ‡ç­¾å·²æ¸…ç†**: åˆ é™¤v4-v7ï¼Œåˆ›å»ºv0.1.0
- âœ… **é…ç½®å·²ä¼˜åŒ–**: æ”¯æŒ0.x.xé¢„å‘å¸ƒæ ¼å¼

### éƒ¨ç½²ä¼˜åŒ–
- âœ… **ç¯å¢ƒåˆ†ç¦»**: stagingå’Œproductionç‹¬ç«‹éƒ¨ç½²
- âœ… **è‡ªåŠ¨éƒ¨ç½²**: æ ¹æ®åˆ†æ”¯è‡ªåŠ¨é€‰æ‹©ç¯å¢ƒ
- âœ… **æ‰‹åŠ¨æ§åˆ¶**: æ”¯æŒå¼ºåˆ¶æŒ‡å®šéƒ¨ç½²ç¯å¢ƒ